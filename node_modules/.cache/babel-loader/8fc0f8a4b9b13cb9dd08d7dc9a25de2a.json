{"ast":null,"code":"var defaultTimestep = 1 / 60 * 1000;\nvar onNextFrame = typeof window !== \"undefined\" ? function (callback) {\n  return window.requestAnimationFrame(callback);\n} : function (callback) {\n  return setTimeout(function () {\n    return callback(performance.now());\n  }, defaultTimestep);\n};\n\nfunction createRenderStep(runNextFrame) {\n  var toRun = [];\n  var toRunNextFrame = [];\n  var numToRun = 0;\n  var isProcessing = false;\n  var toKeepAlive = new WeakSet();\n  var step = {\n    schedule: function schedule(callback, keepAlive, immediate) {\n      if (keepAlive === void 0) {\n        keepAlive = false;\n      }\n\n      if (immediate === void 0) {\n        immediate = false;\n      }\n\n      var addToCurrentFrame = immediate && isProcessing;\n      var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n      if (keepAlive) toKeepAlive.add(callback);\n\n      if (buffer.indexOf(callback) === -1) {\n        buffer.push(callback);\n        if (addToCurrentFrame && isProcessing) numToRun = toRun.length;\n      }\n\n      return callback;\n    },\n    cancel: function cancel(callback) {\n      var index = toRunNextFrame.indexOf(callback);\n      if (index !== -1) toRunNextFrame.splice(index, 1);\n      toKeepAlive.delete(callback);\n    },\n    process: function process(frameData) {\n      var _a;\n\n      isProcessing = true;\n      _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n      toRunNextFrame.length = 0;\n      numToRun = toRun.length;\n\n      if (numToRun) {\n        for (var i = 0; i < numToRun; i++) {\n          var callback = toRun[i];\n          callback(frameData);\n\n          if (toKeepAlive.has(callback)) {\n            step.schedule(callback);\n            runNextFrame();\n          }\n        }\n      }\n\n      isProcessing = false;\n    }\n  };\n  return step;\n}\n\nvar maxElapsed = 40;\nvar useDefaultElapsed = true;\nvar runNextFrame = false;\nvar isProcessing = false;\nvar frame = {\n  delta: 0,\n  timestamp: 0\n};\nvar stepsOrder = [\"read\", \"update\", \"preRender\", \"render\", \"postRender\"];\nvar steps = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n  acc[key] = createRenderStep(function () {\n    return runNextFrame = true;\n  });\n  return acc;\n}, {});\nvar sync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n  var step = steps[key];\n\n  acc[key] = function (process, keepAlive, immediate) {\n    if (keepAlive === void 0) {\n      keepAlive = false;\n    }\n\n    if (immediate === void 0) {\n      immediate = false;\n    }\n\n    if (!runNextFrame) startLoop();\n    return step.schedule(process, keepAlive, immediate);\n  };\n\n  return acc;\n}, {});\nvar cancelSync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n  acc[key] = steps[key].cancel;\n  return acc;\n}, {});\n\nvar processStep = function processStep(stepId) {\n  return steps[stepId].process(frame);\n};\n\nvar processFrame = function processFrame(timestamp) {\n  runNextFrame = false;\n  frame.delta = useDefaultElapsed ? defaultTimestep : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n  frame.timestamp = timestamp;\n  isProcessing = true;\n  stepsOrder.forEach(processStep);\n  isProcessing = false;\n\n  if (runNextFrame) {\n    useDefaultElapsed = false;\n    onNextFrame(processFrame);\n  }\n};\n\nvar startLoop = function startLoop() {\n  runNextFrame = true;\n  useDefaultElapsed = true;\n  if (!isProcessing) onNextFrame(processFrame);\n};\n\nvar getFrameData = function getFrameData() {\n  return frame;\n};\n\nexport default sync;\nexport { cancelSync, getFrameData };","map":{"version":3,"sources":["/Users/maa48/github-projects/etesam-startpage/node_modules/framesync/dist/framesync.es.js"],"names":["defaultTimestep","onNextFrame","window","callback","requestAnimationFrame","setTimeout","performance","now","createRenderStep","runNextFrame","toRun","toRunNextFrame","numToRun","isProcessing","toKeepAlive","WeakSet","step","schedule","keepAlive","immediate","addToCurrentFrame","buffer","add","indexOf","push","length","cancel","index","splice","delete","process","frameData","_a","i","has","maxElapsed","useDefaultElapsed","frame","delta","timestamp","stepsOrder","steps","reduce","acc","key","sync","startLoop","cancelSync","processStep","stepId","processFrame","Math","max","min","forEach","getFrameData"],"mappings":"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","sourcesContent":["var defaultTimestep = 1 / 60 * 1000;\nvar onNextFrame = typeof window !== \"undefined\" ? function (callback) {\n    return window.requestAnimationFrame(callback);\n} : function (callback) {\n    return setTimeout(function () {\n        return callback(performance.now());\n    }, defaultTimestep);\n};\n\nfunction createRenderStep(runNextFrame) {\n    var toRun = [];\n    var toRunNextFrame = [];\n    var numToRun = 0;\n    var isProcessing = false;\n    var toKeepAlive = new WeakSet();\n    var step = {\n        schedule: function (callback, keepAlive, immediate) {\n            if (keepAlive === void 0) {\n                keepAlive = false;\n            }\n            if (immediate === void 0) {\n                immediate = false;\n            }\n            var addToCurrentFrame = immediate && isProcessing;\n            var buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive) toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing) numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: function (callback) {\n            var index = toRunNextFrame.indexOf(callback);\n            if (index !== -1) toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: function (frameData) {\n            var _a;\n            isProcessing = true;\n            _a = [toRunNextFrame, toRun], toRun = _a[0], toRunNextFrame = _a[1];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (var i = 0; i < numToRun; i++) {\n                    var callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n        }\n    };\n    return step;\n}\n\nvar maxElapsed = 40;\nvar useDefaultElapsed = true;\nvar runNextFrame = false;\nvar isProcessing = false;\nvar frame = {\n    delta: 0,\n    timestamp: 0\n};\nvar stepsOrder = [\"read\", \"update\", \"preRender\", \"render\", \"postRender\"];\nvar steps = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = createRenderStep(function () {\n        return runNextFrame = true;\n    });\n    return acc;\n}, {});\nvar sync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    var step = steps[key];\n    acc[key] = function (process, keepAlive, immediate) {\n        if (keepAlive === void 0) {\n            keepAlive = false;\n        }\n        if (immediate === void 0) {\n            immediate = false;\n        }\n        if (!runNextFrame) startLoop();\n        return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n}, {});\nvar cancelSync = /*#__PURE__*/stepsOrder.reduce(function (acc, key) {\n    acc[key] = steps[key].cancel;\n    return acc;\n}, {});\nvar processStep = function (stepId) {\n    return steps[stepId].process(frame);\n};\nvar processFrame = function (timestamp) {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed ? defaultTimestep : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n        useDefaultElapsed = false;\n        onNextFrame(processFrame);\n    }\n};\nvar startLoop = function () {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing) onNextFrame(processFrame);\n};\nvar getFrameData = function () {\n    return frame;\n};\n\nexport default sync;\nexport { cancelSync, getFrameData };\n"]},"metadata":{},"sourceType":"module"}